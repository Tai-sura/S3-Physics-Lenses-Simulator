# Bundle of Light Rays 功能說明

## 概述
在透鏡光學模擬器中新增了"Bundle of Light Rays"（光束）功能，用於顯示從**物體頂部發出的錐形光束**，提供更真實的光學效果，符合實際物理現象。

## 功能位置
- **位置**：左側控制面板 → 顯示選項 → 光束 (Bundle of Light Rays)
- **圖標**：🔍 (fas fa-search-plus)
- **默認狀態**：開啟

## 功能特點

### 1. 錐形光束模擬
- 每個光束包含 **10條光線**
- **所有光線從物體頂部的同一點發出**
- 以15度錐角擴散，模擬真實的點光源效果
- 經過透鏡後會聚到像的頂部

### 2. 物理準確性
- **凸透鏡**：光線會聚到實像頂部或發散形成虛像
- **凹透鏡**：光線始終發散，形成虛像
- 遵循光學折射定律和透鏡成像原理
- **符合實際物理現象**：光束從單點發出

### 3. 視覺效果
- **實像光束**：橙色 (`rgba(255, 140, 0, 0.6)`)
- **虛像光束**：淡金色 (`rgba(255, 215, 0, 0.4)`)
- **虛線效果**：虛像的延長線使用虛線顯示
- **聚焦點**：實像頂部顯示明顯的聚焦效果
- **光束輪廓**：顯示光束的邊界線

### 4. 交互控制
- ✅ 可通過複選框開啟/關閉顯示
- ✅ 與其他光線規則獨立控制
- ✅ 實時響應參數變化

## 與參考圖的對比

### 參考圖特點
- ✅ 光線從物體頂部單點發出
- ✅ 形成錐形光束
- ✅ 經過透鏡後會聚到像頂部
- ✅ 顯示光束的發散和會聚效果

### 實現效果
```
物體頂部 ──┐
           ├─→ 透鏡 ──→ 像頂部
           ├─→        ↗
           └─→      ↗
          錐形光束
```

## 技術實現

### 核心算法
```javascript
// 錐形光束生成
const maxAngle = 15; // 最大發散角度（度）
const baseAngle = Math.atan2(axisY - objectTopY, lensX - objectTopX);
const rayAngle = baseAngle + (i - (numRays - 1) / 2) * (angleRange / (numRays - 1));

// 所有光線從物體頂部發出
ctx.moveTo(objectTopX, objectTopY);
ctx.lineTo(lensX, rayLensY);
```

### 光束輪廓
```javascript
// 實像光束輪廓
ctx.moveTo(objectTopX, objectTopY);
ctx.lineTo(lensX, axisY ± maxAngle * distance);
```

## 使用方法

### 基本操作
1. 打開透鏡模擬器
2. 在左側面板找到"顯示選項"
3. 確認"光束 Bundle of Light Rays"選項已勾選
4. 調整物距、焦距等參數觀察錐形光束變化

### 觀察重點
- **光束起點**：注意所有光線都從物體頂部發出
- **錐形擴散**：觀察光束的錐形發散角度
- **聚焦效果**：實像時光線會聚到像頂部
- **發散效果**：虛像時光線發散但延長線會聚

### 測試場景
- **凸透鏡 + 物距 > 2f**：觀察錐形光束會聚到實像頂部
- **凸透鏡 + 物距 < f**：觀察錐形光束發散形成虛像
- **凹透鏡**：觀察錐形光束始終發散
- **切換透鏡類型**：比較不同透鏡的光束聚散效果

## 與現有功能的整合

### 兼容性
- ✅ 與光線作圖規則（Rule 1, 2, 3）並行顯示
- ✅ 與網格、測量、像、螢幕等顯示選項獨立
- ✅ 支持所有透鏡類型和參數範圍
- ✅ **完美配合物體頂部到像頂部的光路**

### 性能優化
- 使用高效的Canvas繪製
- 光線數量適中（10條），平衡效果與性能
- 條件渲染，僅在需要時繪製
- 錐形算法優化，準確計算光線角度

## 視覺效果展示

### 實像錐形光束（凸透鏡）
```
     物體頂部
        ●
       /|\
      / | \    透鏡    像頂部
     /  |  \     |      ●
    ────┼────    |     /|\
     \  |  /     |    / | \
      \ | /             |
       \|/
```

### 虛像錐形光束（凹透鏡）
```
     物體頂部               虛像頂部
        ●                     ●
       /|\                   /|\
      / | \    透鏡    - - - / | \
     /  |  \     |    - - -/  |  \
    ────┼────    |   - - ────┼────
     \  |  /     |    - - \  |  /
      \ | /             - - \ | /
       \|/                 - \|/
```

## 更新日誌
- **v9.55**: 新增Bundle of Light Rays功能
- **v9.55.1**: 修改為從物體頂部發出的錐形光束
- 實現物理準確的點光源效果
- 添加光束輪廓和聚焦點效果
- 符合參考圖的設計要求

## 技術細節
- **文件修改**：`index.html`, `script.js`, `styles.css`
- **核心函數**：`drawBundleRays()` - 錐形光束算法
- **狀態變量**：`state.display.bundleRays`
- **關鍵參數**：
  - `numRays = 10`：光線數量
  - `maxAngle = 15°`：錐形發散角
  - 光束起點：物體頂部 `objectTopY`
  - 光束終點：像頂部 `imageTopY`

---
*此功能完美實現了從物體頂部到像頂部的錐形光束效果，增強了透鏡模擬器的教學準確性和視覺吸引力。* 